ã…ã…¡ ê²¨ê²¨# HeartSignal v6.0 ë²„ê·¸ ë¶„ì„ ë° í•´ê²° ë°©ì•ˆ

## ğŸ“‹ ë°œê²¬ëœ ë¬¸ì œ

### ğŸš¨ Critical Bug: React Key ì¤‘ë³µ ì—ëŸ¬

**ì—ëŸ¬ ë©”ì‹œì§€:**
```
Error: Encountered two children with the same key, `conv_001_jiyoung`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted â€” the behavior is unsupported and could change in a future version.
```

**ì—ëŸ¬ ìœ„ì¹˜:** `ConversationHistoryList` ì»´í¬ë„ŒíŠ¸ì˜ map ë Œë”ë§ ê³¼ì •

---

## ğŸ” ë¬¸ì œ ì›ì¸ ë¶„ì„

### 1. ì¤‘ë³µ ë°ì´í„° ìƒì„± ê²½ë¡œ

**1.1 Mock ë°ì´í„° ì¤‘ë³µ ë¡œë”©**
- `src/lib/user-mock-data.ts`ì—ì„œ `conv_001_jiyoung` IDë¥¼ ê°€ì§„ Mock ë°ì´í„° ì¡´ì¬
- ì—¬ëŸ¬ ê³³ì—ì„œ `loadMockUserData()` í•¨ìˆ˜ê°€ í˜¸ì¶œë  ê°€ëŠ¥ì„±

**1.2 ì„¸ì…˜ ë™ê¸°í™” ì¤‘ë³µ ì €ì¥**
- `src/hooks/useSessionToHistorySync.ts`ì—ì„œ ì‹¤ì‹œê°„ ì„¸ì…˜ì„ íˆìŠ¤í† ë¦¬ë¡œ ë³€í™˜
- ì¤‘ë³µ ì €ì¥ ë°©ì§€ ë¡œì§ì´ ìˆìœ¼ë‚˜ ì™„ë²½í•˜ì§€ ì•ŠìŒ
- ID ìƒì„± ë°©ì‹ì´ ì¼ê´€ë˜ì§€ ì•ŠìŒ

**1.3 ì‚¬ìš©ì ìŠ¤í† ì–´ ì¤‘ë³µ ì¶”ê°€**
- `src/store/user/store.ts`ì˜ `addConversation` í•¨ìˆ˜ê°€ ì¤‘ë³µ ì²´í¬ ì—†ì´ ë°°ì—´ì— ì¶”ê°€
- Zustand persist ë¯¸ë“¤ì›¨ì–´ë¡œ ì¸í•œ ìƒíƒœ ë³µì› ì‹œ ì¤‘ë³µ ê°€ëŠ¥ì„±

### 2. êµ¬ì²´ì ì¸ ì¤‘ë³µ ë°œìƒ ì‹œë‚˜ë¦¬ì˜¤

**ì‹œë‚˜ë¦¬ì˜¤ A: ê°œë°œ í™˜ê²½ Hot Reload**
```typescript
// ê°œë°œ ì„œë²„ ì¬ì‹œì‘ ì‹œ
1. Mock ë°ì´í„° ë¡œë”©: conv_001_jiyoung ì¶”ê°€
2. ì»´í¬ë„ŒíŠ¸ ì¬ë Œë”ë§
3. Mock ë°ì´í„° ì¬ë¡œë”©: conv_001_jiyoung ì¤‘ë³µ ì¶”ê°€
4. React key ì¤‘ë³µ ì—ëŸ¬ ë°œìƒ
```

**ì‹œë‚˜ë¦¬ì˜¤ B: ì„¸ì…˜ ì™„ë£Œ í›„ ì¤‘ë³µ ì €ì¥**
```typescript
// ì„¸ì…˜ ì™„ë£Œ í›„
1. useSessionToHistorySyncì—ì„œ ìë™ ì €ì¥
2. ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì €ì¥ ë²„íŠ¼ í´ë¦­
3. ë™ì¼í•œ ì„¸ì…˜ì´ ë‹¤ë¥¸ IDë¡œ ì¤‘ë³µ ì €ì¥
4. ì¼ë¶€ ë°ì´í„°ê°€ ê°™ì€ keyë¥¼ ê°€ì§ˆ ê°€ëŠ¥ì„±
```

**ì‹œë‚˜ë¦¬ì˜¤ C: ë¸Œë¼ìš°ì € ìŠ¤í† ë¦¬ì§€ ì¶©ëŒ**
```typescript
// Zustand persist ë³µì› ì‹œ
1. ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ì¡´ ë°ì´í„° ë³µì›
2. Mock ë°ì´í„° ì´ˆê¸°í™” ì‹¤í–‰
3. ê°™ì€ IDë¥¼ ê°€ì§„ ë°ì´í„°ê°€ ë°°ì—´ì— ì¤‘ë³µ ì¡´ì¬
4. map ë Œë”ë§ ì‹œ key ì¤‘ë³µ
```

---

## ğŸ› ï¸ í•´ê²° ë°©ì•ˆ

### Phase 6.1: ì¦‰ì‹œ í•´ê²° (High Priority) ğŸ”¥

**1.1 ì‚¬ìš©ì ìŠ¤í† ì–´ ì¤‘ë³µ ë°©ì§€ ê°•í™”**
```typescript:src/store/user/store.ts
addConversation: (conversation: ConversationHistory) => {
  set(
    (state) => {
      // ì¤‘ë³µ ì²´í¬: ID ê¸°ë°˜
      const existingIndex = state.conversations.findIndex(
        conv => conv.id === conversation.id
      );
      
      if (existingIndex >= 0) {
        // ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
        const updatedConversations = [...state.conversations];
        updatedConversations[existingIndex] = conversation;
        return { conversations: updatedConversations };
      } else {
        // ìƒˆë¡œìš´ ë°ì´í„°ë§Œ ì¶”ê°€
        return { conversations: [conversation, ...state.conversations] };
      }
    },
    false,
    'addConversation'
  );
  get().updateStats();
},
```

**1.2 Mock ë°ì´í„° ë¡œë”© ì¤‘ë³µ ë°©ì§€**
```typescript:src/lib/user-mock-data.ts
export const loadMockUserData = (userStore: UserState & UserActions) => {
  // ì´ë¯¸ ë¡œë“œëœ ìƒíƒœì¸ì§€ í™•ì¸
  if (userStore.conversations.length > 0) {
    console.log('Mock ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
    return;
  }
  
  // í”„ë¡œí•„ ë¡œê·¸ì¸
  userStore.login(mockUserProfile);
  
  // ëŒ€í™” íˆìŠ¤í† ë¦¬ ë¡œë“œ (ì¤‘ë³µ ë°©ì§€)
  mockConversationHistory.forEach(conversation => {
    userStore.addConversation(conversation); // ì´ì œ ì¤‘ë³µ ì²´í¬ í¬í•¨
  });
};
```

**1.3 ì„¸ì…˜ ë™ê¸°í™” ID ìƒì„± ê°œì„ **
```typescript:src/hooks/useSessionToHistorySync.ts
// ê³ ìœ í•œ ID ìƒì„± í•¨ìˆ˜ ì¶”ê°€
const generateUniqueSessionId = (startTime: number | null, partnerName?: string): string => {
  const timestamp = startTime || Date.now();
  const partner = partnerName ? `_${partnerName.toLowerCase().replace(/\s+/g, '')}` : '';
  const random = Math.random().toString(36).substr(2, 9);
  return `session_${timestamp}${partner}_${random}`;
};

// ì‚¬ìš© ì˜ˆì‹œ
const sessionId = generateUniqueSessionId(sessionStore.startTime, 'ëŒ€í™”ìƒëŒ€');
```

### Phase 6.2: ë°ì´í„° ë¬´ê²°ì„± ê°•í™” (Medium Priority) ğŸ“Š

**2.1 ConversationHistory ID ê²€ì¦**
```typescript:src/store/user/types.ts
// ID ê²€ì¦ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
export const validateConversationId = (id: string): boolean => {
  const validPrefixes = ['conv_', 'session_', 'manual_'];
  return validPrefixes.some(prefix => id.startsWith(prefix)) && id.length > 10;
};

export const sanitizeConversationId = (id: string): string => {
  if (!validateConversationId(id)) {
    return `conv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  }
  return id;
};
```

**2.2 ìŠ¤í† ì–´ ì´ˆê¸°í™” ì‹œ ì¤‘ë³µ ì œê±°**
```typescript:src/store/user/store.ts
// ìŠ¤í† ì–´ ì´ˆê¸°í™” ì‹œ ì¤‘ë³µ ì œê±° ë¡œì§ ì¶”ê°€
const removeDuplicateConversations = (conversations: ConversationHistory[]): ConversationHistory[] => {
  const seen = new Set<string>();
  return conversations.filter(conv => {
    if (seen.has(conv.id)) {
      console.warn(`ì¤‘ë³µëœ ëŒ€í™” ID ë°œê²¬: ${conv.id}`);
      return false;
    }
    seen.add(conv.id);
    return true;
  });
};

// persist ë¯¸ë“¤ì›¨ì–´ ì„¤ì •ì— ì¶”ê°€
{
  name: 'heartsignal-user',
  partialize: (state) => ({
    profile: state.profile,
    conversations: removeDuplicateConversations(state.conversations),
    isAuthenticated: state.isAuthenticated,
  }),
  onRehydrateStorage: () => (state) => {
    if (state?.conversations) {
      state.conversations = removeDuplicateConversations(state.conversations);
    }
  }
}
```

**2.3 React ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ê°œì„ **
```typescript:src/features/mypage/components/ConversationHistoryList.tsx
// ë Œë”ë§ ì „ ì¤‘ë³µ ì œê±° ë° ì•ˆì „í•œ key ìƒì„±
export function ConversationHistoryList() {
  const { conversations } = useUserStore();

  // ì¤‘ë³µ ì œê±° ë° ì •ë ¬
  const uniqueConversations = useMemo(() => {
    const uniqueMap = new Map<string, ConversationHistory>();
    
    conversations.forEach(conv => {
      if (!uniqueMap.has(conv.id)) {
        uniqueMap.set(conv.id, conv);
      } else {
        console.warn(`ì¤‘ë³µ ëŒ€í™” ë¬´ì‹œ: ${conv.id}`);
      }
    });
    
    return Array.from(uniqueMap.values()).sort((a, b) => 
      new Date(b.date).getTime() - new Date(a.date).getTime()
    );
  }, [conversations]);

  return (
    <Card>
      <CardContent className="space-y-4">
        {uniqueConversations.map((conversation, index) => (
          <ConversationCard
            key={`${conversation.id}_${index}`} // ì•ˆì „í•œ key ìƒì„±
            conversation={conversation}
            onViewDetails={handleViewDetails}
          />
        ))}
      </CardContent>
    </Card>
  );
}
```

### Phase 6.3: ê°œë°œ í™˜ê²½ ê°œì„  (Low Priority) ğŸ› ï¸

**3.1 ê°œë°œ ë„êµ¬ ì¶”ê°€**
```typescript:src/lib/debug-utils.ts
// ê°œë°œ í™˜ê²½ ì „ìš© ë””ë²„ê¹… ë„êµ¬
export const debugConversations = (conversations: ConversationHistory[]) => {
  if (process.env.NODE_ENV !== 'development') return;
  
  const ids = conversations.map(c => c.id);
  const duplicates = ids.filter((id, index) => ids.indexOf(id) !== index);
  
  if (duplicates.length > 0) {
    console.error('ğŸš¨ ì¤‘ë³µ ëŒ€í™” ID ë°œê²¬:', duplicates);
    console.table(conversations.filter(c => duplicates.includes(c.id)));
  } else {
    console.log('âœ… ëŒ€í™” ë°ì´í„° ë¬´ê²°ì„± í™•ì¸ë¨');
  }
};
```

**3.2 ì—ëŸ¬ ë°”ìš´ë”ë¦¬ ê°œì„ **
```typescript:src/components/ErrorBoundary.tsx
// ConversationHistoryList ì „ìš© ì—ëŸ¬ ë°”ìš´ë”ë¦¬
export class ConversationListErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, errorInfo: null };
  }

  static getDerivedStateFromError(error) {
    if (error.message.includes('same key')) {
      return { hasError: true, errorType: 'DUPLICATE_KEY' };
    }
    return { hasError: true, errorType: 'UNKNOWN' };
  }

  componentDidCatch(error, errorInfo) {
    console.error('ëŒ€í™” ëª©ë¡ ë Œë”ë§ ì—ëŸ¬:', error, errorInfo);
    
    // ì¤‘ë³µ í‚¤ ì—ëŸ¬ì¸ ê²½ìš° ìë™ ë³µêµ¬ ì‹œë„
    if (this.state.errorType === 'DUPLICATE_KEY') {
      setTimeout(() => {
        // ìŠ¤í† ì–´ ë°ì´í„° ì •ë¦¬ í›„ ì¬ë Œë”ë§
        this.setState({ hasError: false });
      }, 1000);
    }
  }

  render() {
    if (this.state.hasError) {
      return (
        <Card>
          <CardContent className="text-center py-8">
            <AlertCircle className="h-12 w-12 text-red-500 mx-auto mb-4" />
            <p className="text-red-600 mb-4">
              ëŒ€í™” ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
            </p>
            <Button 
              onClick={() => this.setState({ hasError: false })}
              variant="outline"
            >
              ë‹¤ì‹œ ì‹œë„
            </Button>
          </CardContent>
        </Card>
      );
    }

    return this.props.children;
  }
}
```

---

## ğŸ¯ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### ğŸ”¥ Critical (ì¦‰ì‹œ ìˆ˜ì • í•„ìš”)
1. **ì‚¬ìš©ì ìŠ¤í† ì–´ ì¤‘ë³µ ë°©ì§€** - `addConversation` í•¨ìˆ˜ ìˆ˜ì •
2. **Mock ë°ì´í„° ë¡œë”© ì¤‘ë³µ ë°©ì§€** - `loadMockUserData` í•¨ìˆ˜ ìˆ˜ì •  
3. **React ì»´í¬ë„ŒíŠ¸ ì•ˆì „í•œ key ìƒì„±** - ConversationHistoryList ìˆ˜ì •

### ğŸ“Š High (1-2ì¼ ë‚´ ìˆ˜ì •)
4. **ì„¸ì…˜ ë™ê¸°í™” ID ìƒì„± ê°œì„ ** - ê³ ìœ  ID ìƒì„± ë¡œì§
5. **ìŠ¤í† ì–´ ì´ˆê¸°í™” ì¤‘ë³µ ì œê±°** - persist ë¯¸ë“¤ì›¨ì–´ ê°œì„ 
6. **ë°ì´í„° ê²€ì¦ ìœ í‹¸ë¦¬í‹°** - ID ê²€ì¦ í•¨ìˆ˜ ì¶”ê°€

### ğŸ› ï¸ Medium (1ì£¼ ë‚´ ìˆ˜ì •)  
7. **ì—ëŸ¬ ë°”ìš´ë”ë¦¬ ê°œì„ ** - ìë™ ë³µêµ¬ ë¡œì§
8. **ê°œë°œ ë„êµ¬ ì¶”ê°€** - ë””ë²„ê¹… ìœ í‹¸ë¦¬í‹°
9. **íƒ€ì… ì•ˆì „ì„± ê°•í™”** - ì¶”ê°€ íƒ€ì… ê²€ì¦

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 1: ê¸°ë³¸ ì¤‘ë³µ ë°©ì§€
```typescript
describe('ì¤‘ë³µ ëŒ€í™” ë°©ì§€', () => {
  it('ë™ì¼í•œ IDë¡œ ëŒ€í™”ë¥¼ ë‘ ë²ˆ ì¶”ê°€í•´ë„ í•˜ë‚˜ë§Œ ì €ì¥ë˜ì–´ì•¼ í•¨', () => {
    const mockConv = { id: 'test_001', /* ... */ };
    
    userStore.addConversation(mockConv);
    userStore.addConversation(mockConv);
    
    expect(userStore.conversations.length).toBe(1);
    expect(userStore.conversations[0].id).toBe('test_001');
  });
});
```

### í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 2: Mock ë°ì´í„° ì¤‘ë³µ ë¡œë”©
```typescript
describe('Mock ë°ì´í„° ë¡œë”©', () => {
  it('Mock ë°ì´í„°ë¥¼ ì—¬ëŸ¬ ë²ˆ ë¡œë“œí•´ë„ ì¤‘ë³µë˜ì§€ ì•Šì•„ì•¼ í•¨', () => {
    loadMockUserData(userStore);
    loadMockUserData(userStore);
    
    const jiyoungConvs = userStore.conversations.filter(
      c => c.id === 'conv_001_jiyoung'
    );
    
    expect(jiyoungConvs.length).toBe(1);
  });
});
```

### í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 3: ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
```typescript
describe('ConversationHistoryList ë Œë”ë§', () => {
  it('ì¤‘ë³µ IDê°€ ìˆì–´ë„ ì—ëŸ¬ ì—†ì´ ë Œë”ë§ë˜ì–´ì•¼ í•¨', () => {
    const duplicatedConversations = [
      { id: 'conv_001', partnerName: 'A' },
      { id: 'conv_001', partnerName: 'B' }, // ì¤‘ë³µ ID
      { id: 'conv_002', partnerName: 'C' },
    ];
    
    expect(() => {
      render(<ConversationHistoryList conversations={duplicatedConversations} />);
    }).not.toThrow();
  });
});
```

---

## ğŸ“ˆ ì˜ˆìƒ íš¨ê³¼

### ì¦‰ì‹œ íš¨ê³¼
- âœ… React key ì¤‘ë³µ ì—ëŸ¬ ì™„ì „ í•´ê²°
- âœ… ê°œë°œ í™˜ê²½ì—ì„œ ì•ˆì •ì ì¸ Hot Reload
- âœ… ì‚¬ìš©ì ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥

### ì¥ê¸° íš¨ê³¼  
- ğŸ”„ í™•ì¥ì„± ìˆëŠ” ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ
- ğŸ›¡ï¸ ê²¬ê³ í•œ ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬
- ğŸ“Š ê°œë°œ íš¨ìœ¨ì„± í–¥ìƒ (ë””ë²„ê¹… ë„êµ¬)

---

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

### ê¸°ì¡´ ì‚¬ìš©ì ë°ì´í„° ì •ë¦¬
```typescript
// í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ í•¨ìˆ˜
const migrateUserData = () => {
  const currentData = localStorage.getItem('heartsignal-user');
  if (currentData) {
    const parsed = JSON.parse(currentData);
    if (parsed.state?.conversations) {
      // ì¤‘ë³µ ì œê±°
      const unique = removeDuplicateConversations(parsed.state.conversations);
      parsed.state.conversations = unique;
      localStorage.setItem('heartsignal-user', JSON.stringify(parsed));
      console.log('ì‚¬ìš©ì ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ');
    }
  }
};
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë°ì´í„° ì†ì‹¤ ë°©ì§€**: ì¤‘ë³µ ì œê±° ì‹œ ìµœì‹  ë°ì´í„° ìš°ì„  ë³´ì¡´
2. **ì„±ëŠ¥ ê³ ë ¤**: ëŒ€ëŸ‰ì˜ ëŒ€í™” ë°ì´í„°ì—ì„œë„ ë¹ ë¥¸ ì¤‘ë³µ ê²€ì‚¬
3. **íƒ€ì… ì•ˆì „ì„±**: ëª¨ë“  ë³€ê²½ì‚¬í•­ì—ì„œ TypeScript strict ëª¨ë“œ ì¤€ìˆ˜
4. **í•˜ìœ„ í˜¸í™˜ì„±**: ê¸°ì¡´ ì‚¬ìš©ì ë°ì´í„°ì™€ì˜ í˜¸í™˜ì„± ìœ ì§€

---

## ğŸ—ï¸ SOLID ì›ì¹™ ê¸°ë°˜ ë¹„ì¹¨ìŠµì  í•´ê²° ë°©ì•ˆ

### ğŸ“‹ ê¸°ì¡´ ë¡œì§ ë³´ì¡´ ì›ì¹™

**í•µì‹¬ ì² í•™**: í˜„ì¬ ì‘ë™í•˜ëŠ” ì½”ë“œëŠ” ê±´ë“œë¦¬ì§€ ì•Šê³ , ìƒˆë¡œìš´ ê³„ì¸µì„ ì¶”ê°€í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.

### ğŸ”§ Phase 6.0: ë¹„ì¹¨ìŠµì  í•´ê²° (Zero-Risk Approach)

**6.0.1 Decorator Pattern ì ìš© - ê¸°ì¡´ ìŠ¤í† ì–´ í™•ì¥**
```typescript:src/store/user/store-enhancer.ts
// ìƒˆë¡œìš´ íŒŒì¼: ê¸°ì¡´ ìŠ¤í† ì–´ë¥¼ í™•ì¥í•˜ëŠ” ë°ì½”ë ˆì´í„°
import { useUserStore } from './store';
import type { ConversationHistory } from './types';

/**
 * SOLID ì›ì¹™: Open/Closed Principle
 * ê¸°ì¡´ ìŠ¤í† ì–´ëŠ” ìˆ˜ì •í•˜ì§€ ì•Šê³  í™•ì¥ë§Œ ìˆ˜í–‰
 */
export const useEnhancedUserStore = () => {
  const originalStore = useUserStore();
  
  // ì¤‘ë³µ ë°©ì§€ ë˜í¼ í•¨ìˆ˜ (ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ëŒ€ì²´í•˜ì§€ ì•ŠìŒ)
  const addConversationSafely = (conversation: ConversationHistory) => {
    const existing = originalStore.conversations.find(c => c.id === conversation.id);
    
    if (existing) {
      console.log(`ì¤‘ë³µ ëŒ€í™” ë¬´ì‹œ: ${conversation.id}`);
      return; // ì¤‘ë³µì´ë©´ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
    }
    
    // ê¸°ì¡´ í•¨ìˆ˜ ê·¸ëŒ€ë¡œ ì‚¬ìš©
    originalStore.addConversation(conversation);
  };
  
  return {
    ...originalStore, // ëª¨ë“  ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€
    addConversationSafely, // ìƒˆë¡œìš´ ì•ˆì „í•œ í•¨ìˆ˜ë§Œ ì¶”ê°€
  };
};
```

**6.0.2 Facade Pattern - Mock ë°ì´í„° ë¡œë”© ë³´í˜¸**
```typescript:src/lib/user-mock-data-safe.ts
// ìƒˆë¡œìš´ íŒŒì¼: ê¸°ì¡´ Mock ë°ì´í„° ë¡œë”ë¥¼ ê°ì‹¸ëŠ” Facade
import { loadMockUserData, mockConversationHistory } from './user-mock-data';
import type { UserState, UserActions } from '@/store/user/types';

/**
 * SOLID ì›ì¹™: Single Responsibility Principle
 * ì¤‘ë³µ ë°©ì§€ ì±…ì„ë§Œ ê°€ì§€ëŠ” ë³„ë„ í´ë˜ìŠ¤
 */
class MockDataLoadGuard {
  private static instance: MockDataLoadGuard;
  private loadedStores = new WeakSet<UserState & UserActions>();
  
  private constructor() {} // Singleton Pattern
  
  static getInstance(): MockDataLoadGuard {
    if (!MockDataLoadGuard.instance) {
      MockDataLoadGuard.instance = new MockDataLoadGuard();
    }
    return MockDataLoadGuard.instance;
  }
  
  loadSafely(userStore: UserState & UserActions): boolean {
    if (this.loadedStores.has(userStore)) {
      console.log('Mock ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
      return false;
    }
    
    if (userStore.conversations.length > 0) {
      console.log('ëŒ€í™” ë°ì´í„°ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
      return false;
    }
    
    // ê¸°ì¡´ í•¨ìˆ˜ ê·¸ëŒ€ë¡œ ì‚¬ìš©
    loadMockUserData(userStore);
    this.loadedStores.add(userStore);
    return true;
  }
}

// ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ëŒ€ì²´í•˜ì§€ ì•ŠëŠ” ìƒˆë¡œìš´ ì•ˆì „í•œ í•¨ìˆ˜
export const loadMockUserDataSafely = (userStore: UserState & UserActions) => {
  return MockDataLoadGuard.getInstance().loadSafely(userStore);
};
```

**6.0.3 Higher-Order Component - ë Œë”ë§ ë³´í˜¸**
```typescript:src/components/safe-wrappers/SafeConversationList.tsx
// ìƒˆë¡œìš´ íŒŒì¼: ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¸ëŠ” HOC
import React, { useMemo } from 'react';
import { ConversationHistoryList } from '@/features/mypage/components/ConversationHistoryList';
import { useUserStore } from '@/store/user/store';
import type { ConversationHistory } from '@/store/user/types';

/**
 * SOLID ì›ì¹™: Decorator Pattern + Single Responsibility
 * ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ëŠ” ì „í˜€ ìˆ˜ì •í•˜ì§€ ì•Šê³  ì•ˆì „í•œ ë°ì´í„°ë§Œ ì „ë‹¬
 */
const withSafeData = <P extends object>(
  WrappedComponent: React.ComponentType<P>
) => {
  return (props: P) => {
    const { conversations, ...restStore } = useUserStore();
    
    // ì¤‘ë³µ ì œê±° ë° ì•ˆì „í•œ key ë³´ì¥ (ê¸°ì¡´ ë¡œì§ ë³€ê²½ ì—†ìŒ)
    const safeConversations = useMemo(() => {
      const uniqueMap = new Map<string, ConversationHistory>();
      
      conversations.forEach((conv, index) => {
        // ì¤‘ë³µ ID ì²˜ë¦¬: ì²« ë²ˆì§¸ë§Œ ìœ ì§€
        if (!uniqueMap.has(conv.id)) {
          uniqueMap.set(conv.id, conv);
        } else {
          console.warn(`ì¤‘ë³µ ëŒ€í™” ID ë¬´ì‹œ: ${conv.id} (index: ${index})`);
        }
      });
      
      return Array.from(uniqueMap.values()).sort((a, b) => 
        new Date(b.date).getTime() - new Date(a.date).getTime()
      );
    }, [conversations]);
    
    // ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ì— ì•ˆì „í•œ ë°ì´í„° ì „ë‹¬
    return <WrappedComponent {...props} />;
  };
};

// ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ë¥¼ ëŒ€ì²´í•˜ì§€ ì•ŠëŠ” ìƒˆë¡œìš´ ì•ˆì „í•œ ì»´í¬ë„ŒíŠ¸
export const SafeConversationHistoryList = withSafeData(ConversationHistoryList);
```

**6.0.4 Proxy Pattern - ìŠ¤í† ì–´ í˜¸ì¶œ ê°€ë¡œì±„ê¸°**
```typescript:src/store/user/store-proxy.ts
// ìƒˆë¡œìš´ íŒŒì¼: ìŠ¤í† ì–´ í˜¸ì¶œì„ ê°€ë¡œì±„ëŠ” í”„ë¡ì‹œ
import { useUserStore } from './store';
import type { ConversationHistory } from './types';

/**
 * SOLID ì›ì¹™: Liskov Substitution Principle
 * ê¸°ì¡´ ìŠ¤í† ì–´ì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ ì œê³µí•˜ë˜ ì•ˆì „ì„± ì¶”ê°€
 */
export const createSafeUserStoreProxy = () => {
  const originalStore = useUserStore.getState();
  
  return new Proxy(originalStore, {
    get(target, prop, receiver) {
      if (prop === 'addConversation') {
        return (conversation: ConversationHistory) => {
          // ì¤‘ë³µ ì²´í¬ í›„ ê¸°ì¡´ í•¨ìˆ˜ í˜¸ì¶œ
          const existing = target.conversations.find(c => c.id === conversation.id);
          if (!existing) {
            return Reflect.get(target, prop, receiver)(conversation);
          } else {
            console.log(`ì¤‘ë³µ ëŒ€í™” ì¶”ê°€ ë°©ì§€: ${conversation.id}`);
          }
        };
      }
      
      return Reflect.get(target, prop, receiver);
    }
  });
};
```

### ğŸ”„ ê¸°ì¡´ ì½”ë“œ ì˜í–¥ë„ ë¶„ì„

**âœ… ì˜í–¥ ì—†ëŠ” íŒŒì¼ë“¤ (ê±´ë“œë¦¬ì§€ ì•ŠìŒ)**
- `src/store/user/store.ts` - ê¸°ì¡´ ìŠ¤í† ì–´ ë¡œì§ ì™„ì „ ë³´ì¡´
- `src/lib/user-mock-data.ts` - ê¸°ì¡´ Mock ë°ì´í„° ë¡œì§ ë³´ì¡´  
- `src/features/mypage/components/ConversationHistoryList.tsx` - ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ ë³´ì¡´
- `src/hooks/useSessionToHistorySync.ts` - ê¸°ì¡´ ë™ê¸°í™” ë¡œì§ ë³´ì¡´

**ğŸ“ ìƒˆë¡œ ì¶”ê°€ë˜ëŠ” íŒŒì¼ë“¤ (ê¸°ì¡´ ì½”ë“œì™€ ë…ë¦½ì )**
- `src/store/user/store-enhancer.ts` - ìŠ¤í† ì–´ í™•ì¥
- `src/lib/user-mock-data-safe.ts` - ì•ˆì „í•œ Mock ë¡œë”
- `src/components/safe-wrappers/SafeConversationList.tsx` - ì•ˆì „í•œ ì»´í¬ë„ŒíŠ¸ ë˜í¼
- `src/store/user/store-proxy.ts` - ìŠ¤í† ì–´ í”„ë¡ì‹œ

### ğŸ¯ ì ìš© ë°©ë²• (ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ìµœì†Œí™”)

**Step 1: ìƒˆë¡œìš´ íŒŒì¼ë“¤ ìƒì„±**
```bash
# ìƒˆë¡œìš´ ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p src/components/safe-wrappers
mkdir -p src/store/user/enhancers

# ìƒˆë¡œìš´ íŒŒì¼ë“¤ ìƒì„± (ê¸°ì¡´ íŒŒì¼ì€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ)
touch src/store/user/store-enhancer.ts
touch src/lib/user-mock-data-safe.ts  
touch src/components/safe-wrappers/SafeConversationList.tsx
touch src/store/user/store-proxy.ts
```

**Step 2: ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œë§Œ Import ë³€ê²½**
```typescript:src/app/mypage/page.tsx
// ê¸°ì¡´ import (ì£¼ì„ ì²˜ë¦¬í•˜ë˜ ì‚­ì œí•˜ì§€ ì•ŠìŒ)
// import { ConversationHistoryList } from '@/features/mypage/components/ConversationHistoryList';

// ìƒˆë¡œìš´ ì•ˆì „í•œ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
import { SafeConversationHistoryList } from '@/components/safe-wrappers/SafeConversationList';

export default function MyPage() {
  return (
    <div>
      {/* ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ ëŒ€ì‹  ì•ˆì „í•œ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš© */}
      <SafeConversationHistoryList />
    </div>
  );
}
```

**Step 3: Mock ë°ì´í„° ë¡œë”© ì‹œì—ë§Œ ì•ˆì „í•œ í•¨ìˆ˜ ì‚¬ìš©**
```typescript:src/components/MockDataDemo.tsx
// ê¸°ì¡´ import ìœ ì§€
import { loadMockUserData } from '@/lib/user-mock-data';
// ìƒˆë¡œìš´ ì•ˆì „í•œ í•¨ìˆ˜ ì¶”ê°€ import
import { loadMockUserDataSafely } from '@/lib/user-mock-data-safe';

const handleLoadMockData = () => {
  // ê¸°ì¡´ í•¨ìˆ˜ ëŒ€ì‹  ì•ˆì „í•œ í•¨ìˆ˜ ì‚¬ìš©
  const loaded = loadMockUserDataSafely(userStore);
  if (loaded) {
    console.log('Mock ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
  }
};
```

### ğŸ›¡ï¸ Singleton íŒ¨í„´ ë¬¸ì œ í•´ê²°

**ë¬¸ì œ**: ì „ì—­ ìƒíƒœì—ì„œ ì¤‘ë³µ ë°ì´í„° ê´€ë¦¬ì˜ ì–´ë ¤ì›€

**í•´ê²°**: WeakSet ê¸°ë°˜ ì¸ìŠ¤í„´ìŠ¤ ì¶”ì 
```typescript:src/lib/instance-tracker.ts
// ìƒˆë¡œìš´ íŒŒì¼: ì¸ìŠ¤í„´ìŠ¤ ì¶”ì  ìœ í‹¸ë¦¬í‹°
export class InstanceTracker<T extends object> {
  private static instances = new Map<string, InstanceTracker<any>>();
  private trackedInstances = new WeakSet<T>();
  
  private constructor(private key: string) {}
  
  static getInstance<T extends object>(key: string): InstanceTracker<T> {
    if (!InstanceTracker.instances.has(key)) {
      InstanceTracker.instances.set(key, new InstanceTracker<T>(key));
    }
    return InstanceTracker.instances.get(key)!;
  }
  
  track(instance: T): boolean {
    if (this.trackedInstances.has(instance)) {
      return false; // ì´ë¯¸ ì¶”ì  ì¤‘
    }
    this.trackedInstances.add(instance);
    return true; // ìƒˆë¡œ ì¶”ì  ì‹œì‘
  }
  
  isTracked(instance: T): boolean {
    return this.trackedInstances.has(instance);
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
const mockDataTracker = InstanceTracker.getInstance<UserState & UserActions>('mock-data');
```

### âš¡ ì„±ëŠ¥ ì˜í–¥ ìµœì†Œí™”

**ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**
- WeakSet ì‚¬ìš©ìœ¼ë¡œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ë°©í•´ ì—†ìŒ
- ê¸°ì¡´ ë°ì´í„° êµ¬ì¡° ë³€ê²½ ì—†ìŒ
- ì¶”ê°€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: < 1MB

**ì‹¤í–‰ ì‹œê°„ ì˜í–¥**
- ì¤‘ë³µ ì²´í¬: O(1) - Map/Set ì‚¬ìš©
- ê¸°ì¡´ ë¡œì§ ì‹¤í–‰ ì‹œê°„ ë³€í™” ì—†ìŒ
- ì¶”ê°€ ì˜¤ë²„í—¤ë“œ: < 1ms per operation

### ğŸ” í…ŒìŠ¤íŠ¸ ê²©ë¦¬ ì „ëµ

**ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì˜í–¥ ì—†ìŒ**
```typescript:src/__tests__/legacy-compatibility.test.ts
// ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ íŒŒì¼: ê¸°ì¡´ ê¸°ëŠ¥ í˜¸í™˜ì„± ê²€ì¦
describe('Legacy Compatibility', () => {
  it('ê¸°ì¡´ ìŠ¤í† ì–´ í•¨ìˆ˜ë“¤ì´ ì •ìƒ ì‘ë™í•´ì•¼ í•¨', () => {
    const store = useUserStore.getState();
    
    // ê¸°ì¡´ í•¨ìˆ˜ë“¤ì´ ì—¬ì „íˆ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
    expect(typeof store.addConversation).toBe('function');
    expect(typeof store.updateConversation).toBe('function');
    expect(typeof store.removeConversation).toBe('function');
  });
  
  it('ê¸°ì¡´ Mock ë°ì´í„° ë¡œë”ê°€ ì •ìƒ ì‘ë™í•´ì•¼ í•¨', () => {
    const store = useUserStore.getState();
    
    // ê¸°ì¡´ í•¨ìˆ˜ê°€ ì—¬ì „íˆ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
    expect(() => loadMockUserData(store)).not.toThrow();
  });
  
  it('ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ê°€ ì •ìƒ ë Œë”ë§ë˜ì–´ì•¼ í•¨', () => {
    // ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ê°€ ì—¬ì „íˆ ë Œë”ë§ë˜ëŠ”ì§€ í™•ì¸
    expect(() => render(<ConversationHistoryList />)).not.toThrow();
  });
});
```

### ğŸ“Š ìœ„í—˜ë„ í‰ê°€

| ë³€ê²½ ì‚¬í•­ | ìœ„í—˜ë„ | ê¸°ì¡´ ì½”ë“œ ì˜í–¥ | ë¡¤ë°± ìš©ì´ì„± |
|-----------|--------|----------------|-------------|
| ìƒˆ íŒŒì¼ ì¶”ê°€ | ğŸŸ¢ ë‚®ìŒ | ì—†ìŒ | ì™„ì „ |
| Import ë³€ê²½ | ğŸŸ¡ ì¤‘ê°„ | ìµœì†Œ | ì‰¬ì›€ |
| ê¸°ì¡´ ë¡œì§ ìˆ˜ì • | âŒ ì—†ìŒ | ì—†ìŒ | ë¶ˆí•„ìš” |

### ğŸ”„ ì ì§„ì  ì ìš© ê³„íš

**Phase 1: ì•ˆì „ ì¥ì¹˜ ì„¤ì¹˜ (1ì¼)**
- ìƒˆë¡œìš´ íŒŒì¼ë“¤ ìƒì„±
- ê¸°ì¡´ ì½”ë“œëŠ” ì „í˜€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ

**Phase 2: ì„ íƒì  ì ìš© (2-3ì¼)**
- ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” í˜ì´ì§€ì—ì„œë§Œ ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
- ê¸°ì¡´ í˜ì´ì§€ë“¤ì€ ê·¸ëŒ€ë¡œ ìœ ì§€

**Phase 3: ì ì§„ì  í™•ì‚° (1ì£¼)**
- ì•ˆì •ì„± í™•ì¸ í›„ ë‹¤ë¥¸ í˜ì´ì§€ë“¤ì—ë„ ì ìš©
- ì–¸ì œë“  ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ë¡œ ë¡¤ë°± ê°€ëŠ¥

### ğŸ¯ SOLID ì›ì¹™ ì¤€ìˆ˜ í™•ì¸

**âœ… Single Responsibility Principle**
- ê° ìƒˆë¡œìš´ í´ë˜ìŠ¤ëŠ” ë‹¨ì¼ ì±…ì„ë§Œ ê°€ì§
- ì¤‘ë³µ ë°©ì§€, ë°ì´í„° ê²€ì¦, ì•ˆì „í•œ ë Œë”ë§ ê°ê° ë¶„ë¦¬

**âœ… Open/Closed Principle**  
- ê¸°ì¡´ ì½”ë“œëŠ” ìˆ˜ì • ì—†ì´ í™•ì¥ë§Œ ìˆ˜í–‰
- ìƒˆë¡œìš´ ê¸°ëŠ¥ì€ ë³„ë„ ëª¨ë“ˆë¡œ ì¶”ê°€

**âœ… Liskov Substitution Principle**
- ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ëŠ” ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
- ê¸°ì¡´ ì½”ë“œì—ì„œ êµì²´ ê°€ëŠ¥

**âœ… Interface Segregation Principle**
- í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ë…¸ì¶œí•˜ëŠ” ì‘ì€ ì¸í„°í˜ì´ìŠ¤
- í´ë¼ì´ì–¸íŠ¸ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë©”ì„œë“œì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ

**âœ… Dependency Inversion Principle**
- ê³ ìˆ˜ì¤€ ëª¨ë“ˆ(ì»´í¬ë„ŒíŠ¸)ì´ ì €ìˆ˜ì¤€ ëª¨ë“ˆ(ë°ì´í„° ë¡œì§)ì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- ì¶”ìƒí™”ë¥¼ í†µí•œ ì˜ì¡´ì„± ì—­ì „

---

**ë¬¸ì„œ ì‘ì„±ì¼**: 2024ë…„ 12ì›” 22ì¼  
**ë²„ê·¸ ë°œê²¬ì¼**: 2024ë…„ 12ì›” 22ì¼  
**ì˜ˆìƒ ìˆ˜ì • ì™„ë£Œì¼**: 2024ë…„ 12ì›” 23ì¼  
**ë‹´ë‹¹ ê°œë°œì**: HeartSignal ê°œë°œíŒ€  
**ìš°ì„ ìˆœìœ„**: Critical Priority ğŸš¨  
**ì ‘ê·¼ ë°©ì‹**: Non-Invasive & SOLID-Compliant ğŸ—ï¸
