# HeartSignal v3.0 개발 계획서

## 📋 프로젝트 개요

**프로젝트명**: HeartSignal 마이페이지 기능 구현  
**버전**: v3.0  
**개발 기간**: 2024년 12월  
**개발자**: HeartSignal 개발팀  

## 🎯 주요 목표

### 1. 사용자 중심 경험 향상
- **박민수** 사용자를 기준으로 한 개인화된 마이페이지 구현
- 직관적이고 사용하기 쉬운 UI/UX 제공
- 기존 디자인 시스템과의 일관성 유지

### 2. 데이터 관리 시스템 구축
- Zustand 기반의 상태 관리 시스템 구현
- 사용자 프로필 및 대화 히스토리 관리
- 실시간 통계 계산 및 분석 기능

### 3. 확장 가능한 아키텍처 설계
- Singleton 패턴 적용으로 일관된 상태 관리
- SOLID 원칙 준수로 유지보수성 향상
- 모듈화된 컴포넌트 구조

## 🏗️ 시스템 아키텍처

### 1. 디렉토리 구조
```
src/
├── store/user/                 # 사용자 상태 관리
│   ├── types.ts               # 타입 정의
│   └── store.ts               # Zustand 스토어
├── features/mypage/           # 마이페이지 기능
│   └── components/            # 마이페이지 컴포넌트들
│       ├── UserProfile.tsx
│       ├── ConversationHistoryList.tsx
│       └── UserStats.tsx
├── lib/
│   └── user-mock-data.ts      # 사용자 Mock 데이터
└── app/mypage/                # 마이페이지 라우트
    └── page.tsx
```

### 2. 상태 관리 설계

#### UserStore (Zustand + Persist)
```typescript
interface UserState {
  profile: UserProfile | null;
  conversations: ConversationHistory[];
  stats: UserStats | null;
  isAuthenticated: boolean;
}
```

**특징**:
- **Singleton 패턴**: 전역에서 하나의 사용자 상태만 관리
- **Persistence**: 브라우저 새로고침 시에도 데이터 유지
- **Real-time Stats**: 대화 추가/수정 시 통계 자동 업데이트

### 3. 컴포넌트 아키텍처

#### 단일 책임 원칙 (SRP) 적용
- `UserProfile`: 사용자 기본 정보 및 프로필 표시만 담당
- `ConversationHistoryList`: 대화 히스토리 목록 관리만 담당
- `UserStats`: 통계 정보 계산 및 표시만 담당

#### 개방-폐쇄 원칙 (OCP) 적용
- 새로운 통계 항목 추가 시 기존 코드 수정 없이 확장 가능
- 새로운 대화 상태 추가 시 기존 로직 영향 없음

## 📊 데이터 모델

### 1. 사용자 프로필 (UserProfile)
```typescript
interface UserProfile {
  id: string;
  name: string;              // "박민수"
  age: number;               // 25
  gender: 'male' | 'female'; // 'male'
  bio: string;               // 자기소개
  interests: string[];       // 관심사 태그
  profileImage?: string;     // 프로필 이미지 URL
  location?: string;         // "서울시 강남구"
  occupation?: string;       // "웹 개발자"
  joinedAt: Date;           // 가입일
}
```

### 2. 대화 히스토리 (ConversationHistory)
```typescript
interface ConversationHistory {
  id: string;
  partnerName: string;       // 상대방 이름
  partnerAge: number;        // 상대방 나이
  date: Date;               // 대화 날짜
  duration: number;         // 대화 시간 (초)
  matchScore: number;       // 매칭 점수 (0-100)
  summary: string;          // AI 생성 요약
  highlights: string[];     // 주요 하이라이트
  status: 'completed' | 'ongoing' | 'cancelled';
}
```

### 3. 사용자 통계 (UserStats)
```typescript
interface UserStats {
  totalConversations: number;    // 총 대화 수
  averageMatchScore: number;     // 평균 매칭 점수
  totalDuration: number;         // 총 대화 시간 (초)
  bestMatchScore: number;        // 최고 매칭 점수
  favoriteTopics: string[];      // 자주 나오는 주제들
}
```

## 🎨 UI/UX 디자인

### 1. 디자인 시스템 준수
- **기존 컬러 팔레트**: Primary(#E95877), Secondary, Neutral 색상 사용
- **Typography**: Geist Sans 폰트 패밀리
- **Spacing**: Tailwind CSS 기본 간격 시스템
- **Components**: shadcn/ui 컴포넌트 활용

### 2. 레이아웃 구조
```
┌─────────────────────────────────────┐
│ Header (with User Icon)             │
├─────────────────────────────────────┤
│ Page Title & Back Button            │
├─────────────┬───────────────────────┤
│ User        │ User Stats            │
│ Profile     │                       │
│ (Left Col)  │ Conversation History  │
│             │ (Right Col)           │
└─────────────┴───────────────────────┘
```

### 3. 반응형 디자인
- **Desktop**: 3컬럼 레이아웃 (프로필 1 : 컨텐츠 2)
- **Tablet**: 2컬럼 레이아웃
- **Mobile**: 1컬럼 스택 레이아웃

## 🔧 기술 스택

### Frontend
- **Framework**: Next.js 15 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **Components**: shadcn/ui
- **Icons**: Lucide React
- **State Management**: Zustand
- **Date Handling**: date-fns
- **Pattern Matching**: ts-pattern

### 개발 도구
- **Linting**: ESLint
- **Code Quality**: TypeScript Strict Mode
- **Git**: 브랜치 전략 (eugene 브랜치)

## 🎭 Mock 데이터 설계

### 박민수 사용자 프로필
```typescript
const mockUserProfile: UserProfile = {
  id: 'user_park_minsu',
  name: '박민수',
  age: 25,
  gender: 'male',
  bio: '웹 개발자로 일하고 있어요. AI와 새로운 기술에 관심이 많고...',
  interests: ['개발', 'AI', '헬스', '등산', '넷플릭스', '요리', '테니스'],
  location: '서울시 강남구',
  occupation: '웹 개발자',
  joinedAt: new Date('2024-01-15'),
};
```

### 대화 히스토리 시나리오
1. **김지영 (24세)** - 최근 대화 (매칭율 82%)
2. **이소영 (26세)** - 2주 전 대화 (매칭율 65%)
3. **박혜진 (23세)** - 3주 전 대화 (매칭율 78%)
4. **김민지 (25세)** - 1개월 전 대화 (매칭율 58%)
5. **최유나 (27세)** - 첫 대화 (매칭율 45%)

## 🚀 구현 단계

### Phase 1: 기반 구조 구축 ✅
- [x] 사용자 타입 정의 (`UserProfile`, `ConversationHistory`, `UserStats`)
- [x] Zustand 스토어 구현 (persistence 포함)
- [x] Mock 데이터 생성 및 로더 함수 구현

### Phase 2: 컴포넌트 개발 ✅
- [x] `UserProfile` 컴포넌트 - 프로필 정보 표시
- [x] `ConversationHistoryList` 컴포넌트 - 대화 목록 및 상세 정보
- [x] `UserStats` 컴포넌트 - 통계 대시보드 및 성과 분석

### Phase 3: 라우팅 및 네비게이션 ✅
- [x] `/mypage` 라우트 생성
- [x] Header에 사용자 아이콘 추가
- [x] 메인 페이지에서 사용자 데이터 자동 로드

### Phase 4: 통합 및 최적화 (예정)
- [ ] 실제 세션 데이터와 사용자 히스토리 연동
- [ ] 대화 상세 모달/페이지 구현
- [ ] 사용자 설정 페이지 추가
- [ ] 성능 최적화 및 접근성 개선

## 🔍 품질 보증

### 1. 코드 품질
- **TypeScript**: 엄격한 타입 체크로 런타임 오류 방지
- **ESLint**: 일관된 코딩 스타일 유지
- **SOLID 원칙**: 유지보수 가능한 코드 구조

### 2. 사용자 경험
- **반응형 디자인**: 모든 디바이스에서 최적화된 경험
- **접근성**: ARIA 라벨 및 키보드 네비게이션 지원
- **로딩 상태**: 데이터 로딩 중 적절한 피드백 제공

### 3. 성능
- **Lazy Loading**: 필요한 컴포넌트만 로드
- **Memoization**: 불필요한 리렌더링 방지
- **최적화된 이미지**: Next.js Image 컴포넌트 활용

## 📈 향후 확장 계획

### 1. 소셜 기능
- 친구 추가 및 매칭 결과 공유
- 대화 스타일 비교 및 추천

### 2. AI 기능 강화
- 개인화된 대화 팁 제공
- 매칭 예측 알고리즘 개선

### 3. 프리미엄 기능
- 상세한 분석 리포트
- 무제한 대화 히스토리 저장

## 🎉 완료된 기능

### ✅ 핵심 기능
1. **사용자 상태 관리**: Zustand + Persistence로 안정적인 상태 관리
2. **마이페이지 UI**: 프로필, 통계, 히스토리를 포함한 완전한 마이페이지
3. **네비게이션**: Header에 사용자 아이콘으로 쉬운 접근
4. **Mock 데이터**: 현실적인 사용자 시나리오 기반 테스트 데이터

### ✅ 기술적 성과
1. **Singleton 패턴**: 전역 사용자 상태의 일관성 보장
2. **SOLID 원칙**: 각 컴포넌트의 단일 책임과 확장성
3. **타입 안전성**: TypeScript로 런타임 오류 방지
4. **반응형 디자인**: 모든 디바이스에서 최적화된 경험

## 🌙 다크모드 시스템 분석 및 개선방안

### 📋 현재 상태 분석

#### ✅ 구현된 기능
1. **테마 토글 버튼**: Header에 Moon/Sun 아이콘으로 테마 전환 가능
2. **테마 상태 관리**: AppContext에서 Zustand와 독립적으로 테마 상태 관리
3. **localStorage 지속성**: 사용자가 선택한 테마를 브라우저에 저장
4. **시스템 테마 감지**: 사용자 OS 설정에 따른 자동 테마 적용

#### ⚠️ 발견된 문제점

1. **이중 테마 시스템 충돌**
   ```typescript
   // 문제: AppContext에서 커스텀 테마 시스템 사용
   const cssVars = generateCSSVariables(theme);
   document.body.className = `theme-${theme.name}`;
   
   // 동시에 globals.css에서 shadcn/ui 표준 다크모드 사용
   .dark { --background: 0 0% 3.9%; }
   ```

2. **Tailwind 다크모드 클래스 미적용**
   ```typescript
   // 현재: body에 theme-light/theme-dark 클래스만 적용
   // 필요: HTML 요소에 'dark' 클래스 적용
   ```

3. **CSS 변수 불일치**
   ```typescript
   // AppContext: --color-primary-500 형태
   // globals.css: --primary 형태 (shadcn/ui 표준)
   ```

### 🔧 해결방안

#### 1. 통합된 다크모드 시스템 구현

**A. AppContext 수정**
```typescript
// src/contexts/AppContext.tsx
useEffect(() => {
  if (typeof window === 'undefined') return;
  
  localStorage.setItem('heartsignal-theme', theme.name);
  
  // HTML 요소에 Tailwind 다크모드 클래스 적용
  const html = document.documentElement;
  if (theme.name === 'dark') {
    html.classList.add('dark');
  } else {
    html.classList.remove('dark');
  }
  
  // 기존 커스텀 CSS 변수도 유지 (브랜드 컬러용)
  const root = document.documentElement;
  const cssVars = generateCSSVariables(theme);
  Object.entries(cssVars).forEach(([property, value]) => {
    root.style.setProperty(property, value);
  });
}, [theme]);
```

**B. 하이브리드 접근법**
- shadcn/ui 표준 다크모드: 기본 UI 컴포넌트용
- 커스텀 CSS 변수: HeartSignal 브랜드 컬러용 (primary-500 등)

#### 2. 초기 렌더링 깜빡임 방지

**A. 서버사이드 테마 감지**
```typescript
// src/app/layout.tsx
export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="ko" suppressHydrationWarning>
      <head>
        <script
          dangerouslySetInnerHTML={{
            __html: `
              (function() {
                const theme = localStorage.getItem('heartsignal-theme') || 
                  (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
                if (theme === 'dark') {
                  document.documentElement.classList.add('dark');
                }
              })();
            `,
          }}
        />
      </head>
      <body className="antialiased min-h-screen bg-background text-foreground">
        {/* ... */}
      </body>
    </html>
  );
}
```

#### 3. 컴포넌트 다크모드 호환성 개선

**A. 일관된 다크모드 클래스 사용**
```typescript
// 기존: 커스텀 색상 직접 사용
className="bg-pink-50 text-gray-900"

// 개선: Tailwind 다크모드 유틸리티 사용
className="bg-pink-50 dark:bg-pink-900/20 text-gray-900 dark:text-gray-100"
```

**B. shadcn/ui 컴포넌트 우선 사용**
```typescript
// 기존: 하드코딩된 색상
className="bg-white border border-gray-200"

// 개선: CSS 변수 기반 색상
className="bg-background border border-border"
```

### 🎯 구현 우선순위

#### Phase 1: 핵심 문제 해결 (즉시)
1. AppContext에서 HTML 요소에 'dark' 클래스 적용
2. 초기 렌더링 깜빡임 방지 스크립트 추가
3. 주요 컴포넌트 다크모드 호환성 검증

#### Phase 2: 시스템 통합 (단기)
1. 모든 커스텀 컴포넌트 다크모드 지원 추가
2. CSS 변수 체계 정리 및 통합
3. 다크모드 전용 브랜드 컬러 최적화

#### Phase 3: 고도화 (장기)
1. 시스템 테마 변경 실시간 감지 개선
2. 다크모드 전환 애니메이션 추가
3. 사용자 테마 선호도 분석 및 개선

### 🧪 테스트 계획

#### 1. 기능 테스트
- [ ] 테마 토글 버튼 동작 확인
- [ ] localStorage 저장/로드 테스트
- [ ] 시스템 테마 자동 감지 테스트
- [ ] 페이지 새로고침 시 테마 유지 확인

#### 2. 호환성 테스트
- [ ] 모든 페이지에서 다크모드 표시 확인
- [ ] shadcn/ui 컴포넌트 다크모드 동작 검증
- [ ] 브랜드 컬러 다크모드 적용 확인

#### 3. 사용자 경험 테스트
- [ ] 초기 로딩 시 깜빡임 없음 확인
- [ ] 테마 전환 시 부드러운 변화 확인
- [ ] 접근성 (키보드 네비게이션, 스크린 리더) 테스트

### 📊 예상 효과

#### 1. 사용자 경험 개선
- 일관된 다크모드 경험 제공
- 눈의 피로 감소 (야간 사용 시)
- 개인화된 테마 설정 만족도 향상

#### 2. 기술적 안정성
- 표준 Tailwind 다크모드 시스템 활용
- shadcn/ui와의 완벽한 호환성
- 유지보수성 향상

#### 3. 브랜드 일관성
- HeartSignal 브랜드 컬러의 다크모드 최적화
- 모든 UI 요소의 통일된 테마 적용

## 📝 결론

HeartSignal v3.0에서는 **박민수** 사용자를 중심으로 한 완전한 마이페이지 기능을 성공적으로 구현했습니다. 

**주요 성과**:
- 🏗️ **확장 가능한 아키텍처**: Singleton 패턴과 SOLID 원칙으로 견고한 기반 구축
- 🎨 **일관된 디자인**: 기존 디자인 시스템과 완벽하게 통합된 UI
- 📊 **실시간 통계**: 대화 데이터 기반의 자동 계산되는 사용자 통계
- 🔄 **상태 지속성**: 브라우저 새로고침에도 유지되는 사용자 데이터
- 🌙 **다크모드 시스템**: 문제점 분석 및 체계적인 개선방안 수립

이 기반 위에서 향후 소셜 기능, AI 강화, 프리미엄 기능 등을 단계적으로 확장할 수 있는 견고한 플랫폼을 완성했습니다.

---

**개발 완료일**: 2024년 12월  
**다음 버전**: v4.0 (실시간 연동 및 고급 기능)
